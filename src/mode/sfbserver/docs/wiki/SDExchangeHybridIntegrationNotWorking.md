# Checks the integration between Skype for Business Server and Exchange Hybrid deployment
**Owner:** Tiago Roxo

# Description

Check the integration between Skype for Business On-Premises and Exchange Hybrid (on-premises & Online)
For more details please refer to the following articles:
- http://blog.schertz.name/2015/09/exchange-and-skype-for-business-integration
- https://docs.microsoft.com/pt-pt/skypeforbusiness/manage/authentication/configure-a-hybrid-environment?redirectedfrom=MSDN
- https://techcommunity.microsoft.com/t5/skype-for-business-blog/online-meeting-icon-missing-from-owa-in-exchange-online/ba-p/621112
- https://docs.microsoft.com/skypeforbusiness/plan-your-deployment/integrate-with-exchange/integrate-with-exchange


[[_TOC_]]

# Execution flow<br/>

::: mermaid
graph LR

Parameter1[\Parameter1\] -.-> Scenario(Scenario)
Parameter2[\Parameter2\] -.-> Scenario(Scenario)
Parameter3[\Parameter3\] -.-> Scenario(Scenario)
Scenario --> Analyzer1(Analyzer1)
Analyzer1 --> Rule1(Rule1)
Rule1 --> Insight1(Insight1)
Rule1 --> Insight2(Insight2)
Insight1 --> Detection(Detection)
Insight1 --> Action(Action)
Insight2 --> ...(...)
:::
___
::: mermaid
graph LR

%%
%% Scenario Name: SDExchangeHybridIntegrationNotWorking
%% Date Generated: 6/23/2021 10:06:56 AM
%% This file is autogenerated. Please do not edit directly
%%

	PDSipAddress[\PDSipAddress\] -.-> SDExchangeHybridIntegrationNotWorking
	PDExchangeServer[\PDExchangeServer\] -.-> SDExchangeHybridIntegrationNotWorking
	PDPromptExchangeAADCreds[\PDPromptExchangeAADCreds\] -.-> SDExchangeHybridIntegrationNotWorking

	SDExchangeHybridIntegrationNotWorking(SDExchangeHybridIntegrationNotWorking) --1--> ADExchangeHybrid[ADExchangeHybrid]

	ADExchangeHybrid -- 1.1 --> RDExchangePowerShellCmdletsLoaded[RDExchangePowerShellCmdletsLoaded]
	ADExchangeHybrid -- 1.2 --> RDTestExchangeCertificateForAutodiscover[RDTestExchangeCertificateForAutodiscover]
	ADExchangeHybrid -- 1.3 --> RDTestAppPrincipalExists[RDTestAppPrincipalExists]
	ADExchangeHybrid -- 1.4 --> RDTestAutoDiscover[RDTestAutoDiscover]
	ADExchangeHybrid -- 1.5 --> RDAutoDiscoverServiceInternalUri[RDAutoDiscoverServiceInternalUri]
	ADExchangeHybrid -- 1.6 --> RDExchangeAutodiscoverUrl[RDExchangeAutodiscoverUrl]
	ADExchangeHybrid -- 1.7 --> RDCsPartnerApplication[RDCsPartnerApplication]
	ADExchangeHybrid -- 1.8 --> RDOAuthCertificateValid[RDOAuthCertificateValid]
	ADExchangeHybrid -- 1.9 --> RDTestOAuthServerConfiguration[RDTestOAuthServerConfiguration]
	ADExchangeHybrid -- 1.10 --> RDTestPartnerApplication[RDTestPartnerApplication]
	ADExchangeHybrid -- 1.11 --> RDTestExchangeConnectivity[RDTestExchangeConnectivity]

:::

# Rule specifications
### R1 - RDAutoDiscoverServiceInternalUri
- Determine if the AutoDiscoverServiceInternalUri value contains a valid configuration<br/>
``` powershell
    $expectedValue = '/Autodiscover/Autodiscover.xml'

    $ClientAccessService = Get-ClientAccessService -Identity EXCHANGE

    if (-not [string]::IsNullOrEmpty($ClientAccessService))
    {
        if ($ClientAccessService.AutoDiscoverServiceInternalUri -notlike "*$($expectedValue)*")
        {
            # Wrong AutoDiscoverServiceInternalUri configuration
            throw 'IDBadAutoDiscoverServiceInternalUri'
        }
    }
    else
    {
        # No value returned for client access server role
        throw 'IDNoClientAccessServerRole'
    }
```

### R2 - RDCsPartnerApplication
- Determine if the partner application exists and is configured with the proper value<br/>
``` powershell
    $expectedValue              = "/Autodiscover/metadata/json/1"

    try
    {
        Set-Variable -Name ProgressPreference -Scope 'Global' -Value "SilentlyContinue" -Force

        $PartnerApplication = Get-CsPartnerApplication -Identity EXCHANGE -ErrorAction SilentlyContinue

        if (-not [string]::IsNullOrEmpty($PartnerApplication))
        {
            if ($PartnerApplication.AuthToken -notlike "*$($expectedValue)")
            {
                # wrong metadaturl configuration
                throw 'IDWrongMetadataUrlConfiguration'
            }
        }
        else
        {
            # unable to get partner application information
            throw 'IDNoPartnerApplication'
        }
```

### R3 - RDExchangeAutodiscoverUrl
- Determine if the OAuth ExchangeAutodiscoverUrl is well configured<br/>
``` powershell
    $expectedValue              = "/Autodiscover/Autodiscover.svc"

    try
    {
        Set-Variable -Name ProgressPreference -Scope 'Global' -Value "SilentlyContinue" -Force

        $oAuthConfiguration = Get-CsOAuthConfiguration

        if (-not [string]::IsNullOrEmpty($oAuthConfiguration))
        {
            if ($oAuthConfiguration.ExchangeAutodiscoverUrl -notlike "*$($expectedValue)*")
            {
                # Not well configured for exchange on-premises
                throw 'IDExchangeAutodiscoverUrlNotConfigured'
            }
        }
        else
        {
            # No oAuth config information returned
            throw 'IDNoOauthConfigurationFound'
        }
```

### R4 - RDExchangePowerShellCmdletsLoaded
- Determine if the Exchange cmdlets are loaded. If not, load them.<br/>
``` powershell
    # Let's see if we've already got the cmdlets (Exchange) that we need access to
    if (-not (Get-Command -Name Get-ClientAccessService -ErrorAction SilentlyContinue))
    {
        $session = New-PSSession -ConfigurationName Microsoft.Exchange `
                                    -ConnectionUri "http://$($obj.ExchangeServer)/PowerShell" `
                                    -Authentication Kerberos `
                                    -Credential $obj.Credential `
                                    -ErrorAction SilentlyContinue

        if (-not [string]::IsNullOrEmpty($session))
        {
            # Import commands from the Exchange Session
            $remoteSession = Import-RemoteSession -Session $Session

            if (-not [string]::IsNullOrEmpty($remoteSession))
            {
                # Did we import the command(s)? Let's check
                if (-not ($remoteSession.ExportedCommands | Where-Object {$_.Keys -eq 'Get-ClientAccessService'}))
                {
                    throw 'IDUnableToImportExchangeCmdlets'
                }
            }
            else
            {
                throw 'IDUnableToImportRemoteSession'
            }
        }
        else
        {
            throw 'IDNoSession'
        }
    }
```

### R5 - RDOAuthCertificateValid
- Determine if the OAuthTokenIssuer certificate has not expired and has a serial number<br/>
``` powershell
    $expectedValue              = "/Autodiscover/metadata/json/1"

    try
    {
        Set-Variable -Name ProgressPreference -Scope 'Global' -Value "SilentlyContinue" -Force

        $OAuthTokenIssuer = Get-CsCertificate -Type OAuthTokenIssuer -ErrorAction SilentlyContinue

        if (-not [string]::IsNullOrEmpty($OAuthTokenIssuer))
        {
            if ($OAuthTokenIssuer.NotAfter -ge (Get-Date))
            {
                if ([string]::IsNullOrEmpty($OAuthTokenIssuer.Thumbprint))
                {
                    throw 'IDOAuthCertficateNoThumbprint'
                }
            }
            else
            {
                throw 'IDOAuthCertficateExpired'
            }
        }
        else
        {
            throw 'IDMissingOAuthCertificate'
        }
```

### R6 - RDTestAppPrincipalExists
- Determine if the app principal ID exists<br/>
``` powershell
    $ServiceName = "00000004-0000-0ff1-ce00-000000000000"

    # 1. Establish connection with Azure Active Directory (AAD)
    Connect-MsolService -AzureEnvironment $global:OPDOptions.AzureEnvironment -ErrorAction SilentlyContinue

    if ($?)
    {
        # Do the rest
        # 2. Does the service name exist?
        $AppPrincipalSFB = Get-MsolServicePrincipalCredential -ReturnKeyValues $true `
                                -ServicePrincipalName $ServiceName `
                                -ErrorAction SilentlyContinue

        if (-not [string]::IsNullOrEmpty($AppPrincipalSFB))
        {
            # 3. List all SPN's configured for O365
            $listSPNs = Get-MsolServicePrincipal -ServicePrincipalName $ServiceName |
                            Select-Object -ExpandProperty ServicePrincipalNames

            if (-not [string]::IsNullOrEmpty($listSPNs))
            {
                # 4. Get the list of all the Skype for Business Server External WebServices
                $listExternalFQDNs = Get-CsService | Select-Object externalfqdn -Unique |
                                        Where-Object {$_.externalfqdn -ne $null}

                $success = $false

                foreach ($listSPN in $listSPNs)
                {
                    if ($listSPN -like "*$($listExternalFQDNs.ExternalFqdn)*")
                    {
                        $success = $success -bor $true
                        break
                    }
                    else
                    {
                        $success = $success -bor $false
                    }
                }

                if (-not $success)
                {
                    throw 'IDExternalWSNotInSPNList'
                }
            }
            else
            {
                throw 'IDNoServicePrincipalNames'
            }
        }
        else
        {
            throw 'IDServicePrincipalDoesNotExist'
        }
    }
    else
    {
        throw 'IDUnableToConnectToAAD'
    }
```

### R7 - RDTestAutoDiscover
- Determine if the DNS name for the Autodiscover is resolvable<br/>
``` powershell
    $domainName               = $env:USERDNSDOMAIN
    $expectedAutoDiscoverName = "autodiscover.$domainName"
    $actualServerName         = $expectedAutoDiscoverName

    Set-Variable -Name ProgressPreference -Scope 'Global' -Value "SilentlyContinue" -Force

    if (-not [string]::IsNullOrEmpty($domainName))
    {

        $autoDiscoverCNAMERecord = Resolve-DnsName -Name $expectedAutoDiscoverName -Server 8.8.8.8 -Type CNAME -ErrorAction SilentlyContinue
        $autoDiscoverARecord     = Resolve-DnsName -Name $actualServerName -Server 8.8.8.8 -Type A -ErrorAction SilentlyContinue |
                                    Where-Object {$_.Type -eq 'A'}

        if (-not [string]::IsNullOrEmpty($autoDiscoverCNAMERecord))
        {
            $actualServerName = $autoDiscoverCNAMERecord.NameHost

            if (-not $actualServerName.EndsWith($domainName,'CurrentCultureIgnoreCase'))
            {
                # CNAME record does not respect strict name matching
                throw 'IDAutoDiscoverNameDoNotMatch'
            }
        }
        elseif ([string]::IsNullOrEmpty($autoDiscoverARecord))
        {
            # Possible missing DNS record
            throw 'IDDNSNameDoesNotExist'
        }
    }
    else
    {
        # unable to determine domain name from the environment variable
        throw 'IDUnknownDomain'
    }
```

### R8 - RDTestExchangeCertificateForAutodiscover
- Determine if the Exchange On-Premise certificate SAN is configured for autodiscovery or wildcard<br/>
``` powershell
    $ExchangeServer  = Get-ParameterDefinition -Object $this -ParameterName 'PDExchangeServer'
    $AutoDiscoverUrl = "https://{0}/autodiscover/autodiscover.json" -f $ExchangeServer
    $Certificate     = Test-CertificateSubject -Url $AutoDiscoverUrl

    if (-not $Certificate)
    {
        throw 'IDAutoDiscoverDoesNotExist'
    }
```

### R9 - RDTestExchangeConnectivity
- Determine if the Skype for Business Server Storage Service is working on a Front End Server<br/>
``` powershell
    $currentSipAddress = Get-ParameterDefinition -Object $this -ParameterName 'PDSipAddress'

    if (-not [string]::IsNullOrEmpty($currentSipAddress))
    {
        $connectivity = Test-CsExStorageConnectivity -SipUri $currentSipAddress -ErrorAction SilentlyContinue

        if ($connectivity -notlike '*passed*')
        {
            # Test failed
            throw 'IDNoExchangeConnectivity'
        }
    }
    else
    {
        # no sip address found - we shouldn't hit this
        throw 'IDNoSIPAddress'
    }
```

### R10 - RDTestOAuthServerConfiguration
- Determine if the OAuthServer configuration is correct<br/>
``` powershell
    $expectedValue              = "https://accounts.accesscontrol.windows.net/{0}/metadata/json/1"

    try
    {
        Set-Variable -Name ProgressPreference -Scope 'Global' -Value "SilentlyContinue" -Force

        $OAuthServerConfiguration = Get-CsOAuthServer -Identity 'microsoft.sts'

        if (-not [string]::IsNullOrEmpty($OAuthServerConfiguration))
        {
            $TenantID = $OAuthServerConfiguration.Realm

            if (-not [string]::IsNullOrEmpty($TenantID))
            {
                $expectedValue = $expectedValue -f $TenantID

                if ($OAuthServerConfiguration.MetadataUrl -ne $expectedValue)
                {
                    throw 'IDWrongOnlineMetadataUrlConfiguration'
                }
            }
            else
            {
                throw 'IDNoTenantIDFound'
            }
        }
        else
        {
            # No oAuth config information returned
            throw 'IDNoOAuthServer'
        }
    }
```

### R11 - RDTestPartnerApplication
- Determine if the Exchange application service exists and has the correct values<br/>
``` powershell
    $ServiceName = "00000002-0000-0ff1-ce00-000000000000"

    $PartnerApplication = Get-CsPartnerApplication -Identity "Microsoft.Exchange"

    if (-not [string]::IsNullOrEmpty($PartnerApplication))
    {
        if ($PartnerApplication.Enabled)
        {
            if ($PartnerApplication.ApplicationIdentifier -ne $ServiceName)
            {
                throw 'IDWrongPartnerApplication'
            }
        }
        else
        {
            throw 'IDPartnerApplicationDisabled'
        }
    }
    else
    {
        throw 'IDNoPartnerApplication'
    }
```

# Messages
When particular rule detects an issue (return value is false) an **Insight detection**
and an **Insight Action** are displayed in addition to an **Analyzer message** and **Rule description**.
For more details, see example below:

(...)
- ***[TODO]***

(...)


### Scenario Description<br/>
| **Language** | **Name** | **Description** |
|:----------|:------|:-------------|
| en-us | SDExchangeHybridIntegrationNotWorking | Checks the integration between Skype for Business Server and Exchange Hybrid deployment


### Parameter description, prompt and example
| **#** | **Language** | **Name** | **Description** | **Prompt** | **Example** |
|:------|:----------|:------|:-------------|:----- |:-----|
| P1 | en-US | PDExchangeServer | Fully qualified domain name (FQDN) of the Exchange server | Exchange server name | exchange.contoso.com |
| P2 | en-US | PDPromptExchangeAADCreds |  | Next you will be prompted for Exchange admin credentials followed by Azure AD admin credentials prompt. Please press Enter to continue |  |
| P3 | en-US | PDSipAddress | The SIP address for the account. Commonly the same as the UPN | User SIP Address | user1@contoso.com | user@domain.contoso.com |

### Analyzer Descriptions
| **#** | **Language** | **Name** | **Description** |
|:------|:----------|:------|:-------------|
| A1 | en-US | ADExchangeHybrid | Verifies that connectivity with Exchange (hybrid configuration) is configured correctly|

### Rule Descriptions
| **#** | **Language** | **Name** | **Description** |
|:------|:---------|:-----|:------------|
| R1 | en-US | RDAutoDiscoverServiceInternalUri | Determine if the AutoDiscoverServiceInternalUri value contains a valid configuration |
| R2 | en-US | RDCsPartnerApplication | Determine if the partner application exists and is configured with the proper value |
| R3 | en-US | RDExchangeAutodiscoverUrl | Determine if the OAuth ExchangeAutodiscoverUrl is well configured |
| R4 | en-US | RDExchangePowerShellCmdletsLoaded | Determine if the Exchange cmdlets are loaded. If not, load them. |
| R5 | en-US | RDOAuthCertificateValid | Determine if the OAuthTokenIssuer certificate has not expired and has a serial number |
| R6 | en-US | RDTestAppPrincipalExists | Determine if the app principal ID exists |
| R7 | en-US | RDTestAutoDiscover | Determine if the DNS name for the Autodiscover is resolvable |
| R8 | en-US | RDTestExchangeCertificateForAutodiscover | Determine if the Exchange On-Premise certificate SAN is configured for autodiscovery or wildcard |
| R9 | en-US | RDTestExchangeConnectivity | Determine if the Skype for Business Server Storage Service is working on a Front End Server |
| R10 | en-US | RDTestOAuthServerConfiguration | Determine if the OAuthServer configuration is correct |
| R11 | en-US | RDTestPartnerApplication | Determine if the Exchange application service exists and has the correct values |

### Insight detection descriptions
| **#** | **Language** | **Name** | **Description** |
|:------|:---------|:-----|:------------|
| ID1 | en-US | IDAutoDiscoverDoesNotExist | The Exchange On-Premise IIS service certificate SAN does not contain an entry for autodiscover service. |
| ID2 | en-US | IDAutoDiscoverNameDoNotMatch | Autodiscover DNS CNAME record '{0}' points to a DNS A record. '{1}' is not respecting domain strict name matching |
| ID3 | en-US | IDBadAutoDiscoverServiceInternalUri | The wrong configuration was found for the AutoDiscoverServiceInternalUri. Expected '{0}' but found '{1}' |
| ID4 | en-US | IDDNSNameDoesNotExist | The DNS name, '{0}', does not appear to exist |
| ID5 | en-US | IDExchangeAutodiscoverUrlNotConfigured | Autodiscover URL is not well formed for Exchange On-Premise. Expected '{0}' but got '{1}' |
| ID6 | en-US | IDExternalWSNotInSPNList | External web service does not exist in Service Principal Names (SPN) list |
| ID7 | en-US | IDMissingOAuthCertificate | Unable to locate a OAuthTokenIssuer certificate |
| ID8 | en-US | IDNoClientAccessServerRole | Unable to determine the client access server role for the Exchange service |
| ID9 | en-US | IDNoExchangeConnectivity | Test-CsExStorageConnectivity cmdlet that verifies if Skype for Business Server Storage service can communicate with Exchange Server failed for SIP user {0} |
| ID10 | en-US | IDNoOauthConfigurationFound | Unable to obtain Exchange AutodiscoverUrl value. |
| ID11 | en-US | IDNoOAuthServer | No output returned by Get-CsAuthServer cmdlet |
| ID12 | en-US | IDNoPartnerApplication | Unable to locate Exchange partner application information. |
| ID13 | en-US | IDNoServicePrincipalNames | Unable to get service principal name information |
| ID14 | en-US | IDNoSession | Unable to establish a connection with '{0}' |
| ID15 | en-US | IDNoSIPAddress | Lookup failed to find '{0}' SIP user. |
| ID16 | en-US | IDNoTenantIDFound | Get-CsOAuthServer cmdlet returned mismatched Metadata URL realm. |
| ID17 | en-US | IDOAuthCertficateExpired | The OAuthTokenIssuer certificate has expired |
| ID18 | en-US | IDOAuthCertficateNoThumbprint | The OAuthTokenIssuer does not have a valid thumbprint |
| ID19 | en-US | IDPartnerApplicationDisabled | Exchange partner application returned by Get-CsPartnerApplication is disable. |
| ID20 | en-US | IDServicePrincipalDoesNotExist | Unable to locate service principal name. |
| ID21 | en-US | IDUnableToConnectToAAD | Unable to establish connection with Azure Active Directory (AAD) |
| ID22 | en-US | IDUnableToImportExchangeCmdlets | Unable to import the Exchange cmdlets from the Exchange server '{0}'. |
| ID23 | en-US | IDUnableToImportRemoteSession | Unable to establish a remote session with server '{0}' |
| ID24 | en-US | IDUnknownDomain | Unable to determine the user DNS domain |
| ID25 | en-US | IDWrongMetadataUrlConfiguration | Wrong partner application AuthToken Metadata configuration detected. Expected '{0}' but got '{1}' |
| ID26 | en-US | IDWrongOnlineMetadataUrlConfiguration | Wrong partner application AuthToken Metadata configuration detected. Expected '{0}' but got '{1}' |
| ID27 | en-US | IDWrongPartnerApplication | Microsoft.Exchange partner application is registered for an incorrect service name. |


### Insight action descriptions
| **#** | **Language** | **Name** | **Description** |
|:------|:---------|:-----|:------------|
| IA1 | en-US | IDAutoDiscoverDoesNotExist | Please review Exchange IIS service certificate or consider using wildcard certificate. For more details, please refer to the following article https://docs.microsoft.com/exchange/architecture/client-access/assign-certificates-to-services?view=exchserver-2019 |
| IA2 | en-US | IDAutoDiscoverNameDoNotMatch | Please confirm that '{0}' CNAME record points to a DNS record within same domain complying with strict name matching. For more details, please refer to the following article: https://docs.microsoft.com/exchange/architecture/client-access/autodiscover?view=exchserver-2019. |
| IA3 | en-US | IDBadAutoDiscoverServiceInternalUri | Please verify and correct AutoDiscoverServiceInternalUri configuration using Set-ClientAccessServer cmdlet. |
| IA4 | en-US | IDDNSNameDoesNotExist | Please verify that the domain name, '{0}', is correct and attempt this operation again. |
| IA5 | en-US | IDExchangeAutodiscoverUrlNotConfigured | Please refer to the following for guidance: https://blog.schertz.name/2015/09/exchange-and-skype-for-business-integration/ |
| IA6 | en-US | IDExternalWSNotInSPNList | Please verify that Skype for Business Server external Web services URLs are registered as Service Principal names. For more details please refer to the following article https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment |
| IA7 | en-US | IDMissingOAuthCertificate | Please open Skype for Business Server Deployment Wizard, select Install or Update Skype for Business Server System and run Step 3 to validate OAuth certificate. For more details please refer to the following article https://docs.microsoft.com/skypeforbusiness/manage/authentication/assign-a-server-to-server-certificate. |
| IA8 | en-US | IDNoClientAccessServerRole | Please review the client access server role Exchange service using Get-ClientAccessServer cmdlet. |
| IA9 | en-US | IDNoExchangeConnectivity | Please refer to the following for guidance: https://blog.schertz.name/2015/09/exchange-and-skype-for-business-integration/ |
| IA10 | en-US | IDNoOauthConfigurationFound | Please refer to the following guidance: https://docs.microsoft.com/skypeforbusiness/plan-your-deployment/integrate-with-exchange/integrate-with-exchange |
| IA11 | en-US | IDNoOAuthServer | Please confirm PowerShell script available at https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment has been properly executed. |
| IA12 | en-US | IDNoPartnerApplication | Please refer to the following guidance: https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment |
| IA13 | en-US | IDNoServicePrincipalNames | Please verify that Skype for Business Server external Web services URls are registered as Service Principal names. For more details please refer to the following article https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment |
| IA14 | en-US | IDNoSession | Please verify that the username and/or password supplied are correct and retry |
| IA15 | en-US | IDNoSIPAddress | Please verify that SIP user {0} is SIP enabled and have an associated mailbox. |
| IA16 | en-US | IDNoTenantIDFound | Please confirm that prior to executing PowerShell script available at https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment you have replaced 'Fabrikam.com' by your tenant default domain |
| IA17 | en-US | IDOAuthCertficateExpired | Please open Skype for Business Server Deployment Wizard, select Install or Update Skype for Business Server System and run Step 3 to validate OAuth certificate. For more details please refer to the following article https://docs.microsoft.com/skypeforbusiness/manage/authentication/assign-a-server-to-server-certificate. |
| IA18 | en-US | IDOAuthCertficateNoThumbprint | Please open Skype for Business Server Deployment Wizard, select Install or Update Skype for Business Server System and run Step 3 to validate OAuth certificate. For more details please refer to the following article https://docs.microsoft.com/skypeforbusiness/manage/authentication/assign-a-server-to-server-certificate. |
| IA19 | en-US | IDPartnerApplicationDisabled | Please consider enabling partner application or just re-run PowerShell script available at https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment |
| IA20 | en-US | IDServicePrincipalDoesNotExist | Please verify that Skype for Business Server external Web services URLs are registered as Service Principal names. For more details please refer to the following article https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment |
| IA21 | en-US | IDUnableToConnectToAAD | Please verify you can connect to Azure AD using Connect-MsolService. For more details please refer to the following article https://docs.microsoft.com/microsoft-365/enterprise/connect-to-microsoft-365-powershell?view=o365-worldwide |
| IA22 | en-US | IDUnableToImportExchangeCmdlets | Please verify if remote Exchange PowerShell control for server '{0}' is allowed. For more details please refer to the following article: https://docs.microsoft.com/powershell/exchange/control-remote-powershell-access-to-exchange-servers?view=exchange-ps |
| IA23 | en-US | IDUnableToImportRemoteSession | Please verify if remote Exchange PowerShell control for server '{0}' is allowed. For more details please refer to the following article: https://docs.microsoft.com/powershell/exchange/control-remote-powershell-access-to-exchange-servers?view=exchange-ps |
| IA24 | en-US | IDUnknownDomain | Please confirm if $env:USERDNSDOMAIN environment variable points to correct user local domain |
| IA25 | en-US | IDWrongMetadataUrlConfiguration | Please refer to the following guidance: https://docs.microsoft.com/skypeforbusiness/deploy/integrate-with-exchange-server/configure-partner-applications |
| IA26 | en-US | IDWrongOnlineMetadataUrlConfiguration | Please refer to the following guidance: https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment |
| IA27 | en-US | IDWrongPartnerApplication | Please re-run PowerShell script available at https://docs.microsoft.com/skypeforbusiness/manage/authentication/configure-a-hybrid-environment |